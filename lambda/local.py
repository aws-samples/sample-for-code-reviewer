import os, json

PROJECT_NAME = 'cr'
os.environ['BUCKET_NAME'] = 'cr-report-257712309840-us-east-1'
os.environ['REQUEST_TABLE'] = f'{PROJECT_NAME}-request'
os.environ['TASK_TABLE'] = f'{PROJECT_NAME}-task'
os.environ['TASK_SQS_URL'] = 'https://sqs.us-east-1.amazonaws.com/257712309840/cr-queue'
os.environ['SNS_TOPIC_ARN'] = 'arn:aws:sns:us-east-1:257712309840:cr-topic'
os.environ['TASK_DISPATCHER_FUN_NAME'] = f'{PROJECT_NAME}-task-dispatcher'

def run_request_handler():
	from request_handler import lambda_handler
	event_data = "{\"resource\":\"/codereview\",\"path\":\"/codereview\",\"httpMethod\":\"POST\",\"headers\":{\"Accept\":\"*/*\",\"Accept-Encoding\":\"gzip;q=1.0,deflate;q=0.6,identity;q=0.3\",\"Content-Type\":\"application/json\",\"Host\":\"ps346j0cei.execute-api.us-east-1.amazonaws.com\",\"User-Agent\":\"GitLab/17.1.1-ee\",\"X-Amzn-Trace-Id\":\"Root=1-66dfba0b-1770d74e01a58fca512729ee\",\"X-Forwarded-For\":\"18.206.126.21\",\"X-Forwarded-Port\":\"443\",\"X-Forwarded-Proto\":\"https\",\"X-Gitlab-Event\":\"Push Hook\",\"X-Gitlab-Event-Uuid\":\"4e9b50c1-eb8d-43a2-af44-a53a0e1fc60e\",\"X-Gitlab-Instance\":\"http://ec2-18-206-126-21.compute-1.amazonaws.com\",\"X-Gitlab-Token\":\"glpat-SjWzNxZ_EybWfqJshzzH\",\"X-Gitlab-Webhook-Uuid\":\"54943f25-4376-4382-93a3-02a06affc093\"},\"multiValueHeaders\":{\"Accept\":[\"*/*\"],\"Accept-Encoding\":[\"gzip;q=1.0,deflate;q=0.6,identity;q=0.3\"],\"Content-Type\":[\"application/json\"],\"Host\":[\"ps346j0cei.execute-api.us-east-1.amazonaws.com\"],\"User-Agent\":[\"GitLab/17.1.1-ee\"],\"X-Amzn-Trace-Id\":[\"Root=1-66dfba0b-1770d74e01a58fca512729ee\"],\"X-Forwarded-For\":[\"18.206.126.21\"],\"X-Forwarded-Port\":[\"443\"],\"X-Forwarded-Proto\":[\"https\"],\"X-Gitlab-Event\":[\"Push Hook\"],\"X-Gitlab-Event-Uuid\":[\"4e9b50c1-eb8d-43a2-af44-a53a0e1fc60e\"],\"X-Gitlab-Instance\":[\"http://ec2-18-206-126-21.compute-1.amazonaws.com\"],\"X-Gitlab-Token\":[\"glpat-SjWzNxZ_EybWfqJshzzH\"],\"X-Gitlab-Webhook-Uuid\":[\"54943f25-4376-4382-93a3-02a06affc093\"]},\"queryStringParameters\":null,\"multiValueQueryStringParameters\":null,\"pathParameters\":null,\"stageVariables\":null,\"requestContext\":{\"resourceId\":\"u0km08\",\"resourcePath\":\"/codereview\",\"httpMethod\":\"POST\",\"extendedRequestId\":\"d3oBxFpUIAMEXDA=\",\"requestTime\":\"10/Sep/2024:03:16:27 +0000\",\"path\":\"/prod/codereview\",\"accountId\":\"257712309840\",\"protocol\":\"HTTP/1.1\",\"stage\":\"prod\",\"domainPrefix\":\"ps346j0cei\",\"requestTimeEpoch\":1725938187059,\"requestId\":\"c1128a4f-5385-45f0-9bf7-2cebac249ff9\",\"identity\":{\"cognitoIdentityPoolId\":null,\"accountId\":null,\"cognitoIdentityId\":null,\"caller\":null,\"sourceIp\":\"18.206.126.21\",\"principalOrgId\":null,\"accessKey\":null,\"cognitoAuthenticationType\":null,\"cognitoAuthenticationProvider\":null,\"userArn\":null,\"userAgent\":\"GitLab/17.1.1-ee\",\"user\":null},\"domainName\":\"ps346j0cei.execute-api.us-east-1.amazonaws.com\",\"deploymentId\":\"53ya9z\",\"apiId\":\"ps346j0cei\"},\"body\":\"{\\\"object_kind\\\":\\\"push\\\",\\\"event_name\\\":\\\"push\\\",\\\"before\\\":\\\"41903b7d8ceecc2973027d4f6a2988594d34b3db\\\",\\\"after\\\":\\\"36136f35b91cd14c71f9958be0a8fb7213d91d51\\\",\\\"ref\\\":\\\"refs/heads/dev\\\",\\\"ref_protected\\\":false,\\\"checkout_sha\\\":\\\"36136f35b91cd14c71f9958be0a8fb7213d91d51\\\",\\\"message\\\":null,\\\"user_id\\\":1,\\\"user_name\\\":\\\"Administrator\\\",\\\"user_username\\\":\\\"root\\\",\\\"user_email\\\":null,\\\"user_avatar\\\":\\\"https://www.gravatar.com/avatar/5d7ee254a141074d930bc80b3f5507c33c499d3b8e11609e1e354f16b42e5a9d?s=80&d=identicon\\\",\\\"project_id\\\":1,\\\"project\\\":{\\\"id\\\":1,\\\"name\\\":\\\"first\\\",\\\"description\\\":null,\\\"web_url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first\\\",\\\"avatar_url\\\":null,\\\"git_ssh_url\\\":\\\"git@ec2-18-206-126-21.compute-1.amazonaws.com:demo/first.git\\\",\\\"git_http_url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first.git\\\",\\\"namespace\\\":\\\"demo\\\",\\\"visibility_level\\\":0,\\\"path_with_namespace\\\":\\\"demo/first\\\",\\\"default_branch\\\":\\\"main\\\",\\\"ci_config_path\\\":null,\\\"homepage\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first\\\",\\\"url\\\":\\\"git@ec2-18-206-126-21.compute-1.amazonaws.com:demo/first.git\\\",\\\"ssh_url\\\":\\\"git@ec2-18-206-126-21.compute-1.amazonaws.com:demo/first.git\\\",\\\"http_url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first.git\\\"},\\\"commits\\\":[{\\\"id\\\":\\\"43ff6ba695e8e8dba5898f04b59d6dcab0e31ca3\\\",\\\"message\\\":\\\"Add git ignore file\\\\n\\\",\\\"title\\\":\\\"Add git ignore file\\\",\\\"timestamp\\\":\\\"2024-09-10T11:16:23+08:00\\\",\\\"url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first/-/commit/43ff6ba695e8e8dba5898f04b59d6dcab0e31ca3\\\",\\\"author\\\":{\\\"name\\\":\\\"wengkaer\\\",\\\"email\\\":\\\"wengkaer@amazon.com\\\"},\\\"added\\\":[\\\".gitignore\\\"],\\\"modified\\\":[],\\\"removed\\\":[]},{\\\"id\\\":\\\"e6b999ba92c70d0129c4870056eb8b86914dc641\\\",\\\"message\\\":\\\"增加pom.xml和主程序App.java\\\\n\\\",\\\"title\\\":\\\"增加pom.xml和主程序App.java\\\",\\\"timestamp\\\":\\\"2024-09-10T11:16:23+08:00\\\",\\\"url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first/-/commit/e6b999ba92c70d0129c4870056eb8b86914dc641\\\",\\\"author\\\":{\\\"name\\\":\\\"wengkaer\\\",\\\"email\\\":\\\"wengkaer@amazon.com\\\"},\\\"added\\\":[\\\"pom.xml\\\",\\\"src/main/java/demo/great/App.java\\\"],\\\"modified\\\":[],\\\"removed\\\":[]},{\\\"id\\\":\\\"2194f1e7d7b786045ed31cc19751db34ed8460e3\\\",\\\"message\\\":\\\"增加base和config包\\\\n\\\",\\\"title\\\":\\\"增加base和config包\\\",\\\"timestamp\\\":\\\"2024-09-10T11:16:23+08:00\\\",\\\"url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first/-/commit/2194f1e7d7b786045ed31cc19751db34ed8460e3\\\",\\\"author\\\":{\\\"name\\\":\\\"wengkaer\\\",\\\"email\\\":\\\"wengkaer@amazon.com\\\"},\\\"added\\\":[\\\"src/main/java/demo/great/base/GreatException.java\\\",\\\"src/main/java/demo/great/config/DataSourceConfig.java\\\",\\\"src/main/java/demo/great/config/DataSourceContextHolder.java\\\",\\\"src/main/java/demo/great/config/DataSourceType.java\\\",\\\"src/main/java/demo/great/config/DynamicDataSource.java\\\",\\\"src/main/java/demo/great/config/DynamicDataSourceContextHolder.java\\\"],\\\"modified\\\":[],\\\"removed\\\":[]},{\\\"id\\\":\\\"36136f35b91cd14c71f9958be0a8fb7213d91d51\\\",\\\"message\\\":\\\"Add .codereview\\\\n\\\",\\\"title\\\":\\\"Add .codereview\\\",\\\"timestamp\\\":\\\"2024-09-10T11:16:23+08:00\\\",\\\"url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first/-/commit/36136f35b91cd14c71f9958be0a8fb7213d91d51\\\",\\\"author\\\":{\\\"name\\\":\\\"wengkaer\\\",\\\"email\\\":\\\"wengkaer@amazon.com\\\"},\\\"added\\\":[\\\".codereview/java-general.merge.yaml\\\",\\\".codereview/java-general.push.yaml\\\",\\\".codereview/pom.push.yaml\\\"],\\\"modified\\\":[],\\\"removed\\\":[]}],\\\"total_commits_count\\\":4,\\\"push_options\\\":{},\\\"repository\\\":{\\\"name\\\":\\\"first\\\",\\\"url\\\":\\\"git@ec2-18-206-126-21.compute-1.amazonaws.com:demo/first.git\\\",\\\"description\\\":null,\\\"homepage\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first\\\",\\\"git_http_url\\\":\\\"http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/first.git\\\",\\\"git_ssh_url\\\":\\\"git@ec2-18-206-126-21.compute-1.amazonaws.com:demo/first.git\\\",\\\"visibility_level\\\":0}}\",\"isBase64Encoded\":false}"
	lambda_handler(json.loads(event_data), dict())

def run_task_dispatcher():
	from task_dispatcher import lambda_handler
	event = {
        "mode": "single",
        "model": "claude3-sonnet",
        "event_type": "push",
        "web_url": "http://ec2-18-206-126-21.compute-1.amazonaws.com/demo/account-book",
        "path_with_namespace": "demo/account-book",
        "target_branch": "dev",
        "ref": "dev",
        "commit_id": "6deaadb31765e44d3e5b74ddab5e832355f2a512",
        "previous_commit_id": "acb7bb8b92e2d08b50ef8589ecdd827caea2600c",
        "private_token": "glpat-9SvVZ79rtPLZuFQGLKjy",
        "target": "**.py, **.java, **.js",
        "rule_name": None,
        "confirm": True,
        "confirm_prompt": "请进行二次确认，检查你的答案的正确性",
        "source": "gitlab",
        "project_name": "Test Project",
        "project_id": "demo/account-book",
        "repo_url": "http://ec2-18-206-126-21.compute-1.amazonaws.com/",
        "username": "mock",
        "webtool_prompt_system": "",
        "webtool_prompt_user": "以下是我的代码\n{{code}}\n\n我的规范如下：\n- 代码应该尽可能简化，能够通过优雅写法编写代码，就不应该写复杂了。\n\n你的任务如下：\n- 请帮忙检查代码中有没有明显的可以换成更简单写法的代码，找出来并给出优化建议。\n\n输出格式要求如下：\nOutput all your message in this format \"<output>your finding</output><thought>your thought</thought>\"\n\nOutput your finding into <output></output> tag in the following JSON format:\n```json\n[\n  {\n    \"title\": \"summary your finding, less than 30 words, in Chinese, no QUOTES and backslashes symbol here\",\n    \"content\": \"your finding, in Chinese, no QUOTES and backslashes symbol here\", \n    \"filepath\": \"filepath @ line number range, no QUOTES and backslashes symbol here\"\n  },\n  // other findings...\n]\n```\nIn field content, you must explain why it is incorrect, provide evidence. must\ndisplay code snippets in markdown code block. must tell how to improve. This\npart should be as much detail as possible, provide evidence to support your\nconclusion. \n\nVERY IMPORTANT: \n- you mush make sure the JSON output is a valid JSON. \n- Be careful about each field in the JSON output. QUOTES and backslashes and\nnewline always make errors. \n- Make sure you escape these symbols in JSON value field.\n- No need to escape newline symbol outside JSON data!\n这是一个好的例子:\n\n```json\n\n[\n    {\n        \"title\": \"导致系统崩溃的潜在安全漏洞\",\n        \"content\": \"在该文件中,我们发现了一个潜在的安全漏洞。\\n代码如下:\\n```java\\nif @condition) {\\n    doSomethingUnsafe();\\n}\\n```\\n这段代码可能会导致系统崩溃,因为在某些情况下,`doSomethingUnsafe()`方法可能会执行一些不安全的操作。我们建议修复这个问题\",\n        \"filepath\": \"src/main/java/com/example/App.java @line 45-50\"\n    }\n]\n\n```\n\n这是一个坏的例子:\n\n```json\n\n[\n    {\n        \"title\": \"导致系统崩溃的潜在安全漏洞\",\n        \"content\": \"在该文件中,我们发现了一个名为\"追踪者\"的安全漏洞。\\n代码如下:\\n```java\\nif @condition) {\\\\n    doSomethingUnsafe();\\n}\\n```\\n这段代码可能会导致系统崩溃,因为在某些情况下,`doSomethingUnsafe()`方法可能会执行一些不安全的操作。我们建议修复这个问题\",\n        \"filepath\": \"src/main/java/com/example/App.java @line 45-50\"\n    }\n]\n\n```\n\n因为在「名为\"追踪者\"的安全漏洞」中出现了未转义的双引号。\n\nOutput your thought process in the <thought> tag, you will indicate which\nparts of my guidelines were violated in the <thought> tag too.\n\n\nIMPORTANT: \n- nothing should be output outside <output> and <thought> tag.\n- Find as many issues as possible\n- Don't force finding problems, having no issues is a good thing. If you can't\nfind any problems, just output [] inside <output></output> tag.\n\n其他要求如下：\n请你逐步思考！\n\nPlease:\n- You will strictly follow my guidelines and requirements. Even if you something conforming to my guidelines is incorrect, do not output it.\n- You don't need to repeat my requirements.",
        "request_id": "20240925_114035_gitlab_mock",
        "invoker": "webtool"
    }
	lambda_handler(event, dict())

def run_task_executor():
	from task_executor import lambda_handler
	event_log = '''
{
    "timestamp": "2024-09-25T17:38:55Z",
    "level": "DEBUG",
    "message": {
        "Records": [
            {
                "messageId": "f5835272-2e56-4c4e-9335-7aa680b01425",
                "receiptHandle": "AQEBp6UqbO1cl6Ijc2GP0JfK1qwcFRvgOQ2sZQyjgRCJPxu4gwcY5L85VKR4nAjp0jHeDZOcCc7l8dbpeNaTiB2qAiPxnqQdgb0hXxoX/JWI2aHD9MaPNrAjJAo3kuCBw/+Bg9EDP3+juD/grZEL2Lsj750LHV+DcNb9R+kfHVmUt3gDVn14pNVov965XYT6oWy8ZG5AkRVDA6iIzgSLIjTpLTAVJFSNlFJK+BiPxoSysqFoZ0Y+VoNqU90UwBo9ooMlM2nFfHVJuOUWmSr5e9AtYlnjz+33SEtT/fOH6mn5Q8BMokqVDCYVZsn0XAZ/Z3xFvCP07euDK186XIWLFOipOt0EObe1oXoZ1Xh17go1oRrHzzrL1NYhrxJ8tRYklXeLL/0wLPXrecjqK+nKjug4Bg==",
                "body": "eyJjb250ZXh0IjogeyJtb2RlIjogInNpbmdsZSIsICJtb2RlbCI6ICJjbGF1ZGUzLXNvbm5ldCIsICJldmVudF90eXBlIjogInB1c2giLCAid2ViX3VybCI6ICJodHRwOi8vZWMyLTE4LTIwNi0xMjYtMjEuY29tcHV0ZS0xLmFtYXpvbmF3cy5jb20vZGVtby9hY2NvdW50LWJvb2siLCAicGF0aF93aXRoX25hbWVzcGFjZSI6ICJkZW1vL2FjY291bnQtYm9vayIsICJ0YXJnZXRfYnJhbmNoIjogImRldiIsICJyZWYiOiAiZGV2IiwgImNvbW1pdF9pZCI6ICI2ZGVhYWRiMzE3NjVlNDRkM2U1Yjc0ZGRhYjVlODMyMzU1ZjJhNTEyIiwgInByZXZpb3VzX2NvbW1pdF9pZCI6ICJhY2I3YmI4YjkyZTJkMDhiNTBlZjg1ODllY2RkODI3Y2FlYTI2MDBjIiwgInByaXZhdGVfdG9rZW4iOiAiZ2xwYXQtOVN2Vlo3OXJ0UExadUZRR0xLankiLCAidGFyZ2V0IjogIioqLnB5LCAqKi5qYXZhLCAqKi5qcyIsICJydWxlX25hbWUiOiBudWxsLCAiY29uZmlybSI6IHRydWUsICJjb25maXJtX3Byb21wdCI6ICLor7fov5vooYzkuozmrKHnoa7orqTvvIzmo4Dmn6XkvaDnmoTnrZTmoYjnmoTmraPnoa7mgKciLCAic291cmNlIjogImdpdGxhYiIsICJwcm9qZWN0X25hbWUiOiAiVGVzdCBQcm9qZWN0IiwgInByb2plY3RfaWQiOiAiZGVtby9hY2NvdW50LWJvb2siLCAicmVwb191cmwiOiAiaHR0cDovL2VjMi0xOC0yMDYtMTI2LTIxLmNvbXB1dGUtMS5hbWF6b25hd3MuY29tLyIsICJ1c2VybmFtZSI6ICJtb2NrIiwgIndlYnRvb2xfcHJvbXB0X3N5c3RlbSI6ICIiLCAid2VidG9vbF9wcm9tcHRfdXNlciI6ICLku6XkuIvmmK/miJHnmoTku6PnoIFcbnt7Y29kZX19XG5cbuaIkeeahOinhOiMg+WmguS4i++8mlxuLSDku6PnoIHlupTor6XlsL3lj6/og73nroDljJbvvIzog73lpJ/pgJrov4fkvJjpm4Xlhpnms5XnvJblhpnku6PnoIHvvIzlsLHkuI3lupTor6XlhpnlpI3mnYLkuobjgIJcblxu5L2g55qE5Lu75Yqh5aaC5LiL77yaXG4tIOivt+W4ruW/meajgOafpeS7o+eggeS4reacieayoeacieaYjuaYvueahOWPr+S7peaNouaIkOabtOeugOWNleWGmeazleeahOS7o+egge+8jOaJvuWHuuadpeW5tue7meWHuuS8mOWMluW7uuiuruOAglxuXG7ovpPlh7rmoLzlvI/opoHmsYLlpoLkuIvvvJpcbk91dHB1dCBhbGwgeW91ciBtZXNzYWdlIGluIHRoaXMgZm9ybWF0IFwiPG91dHB1dD55b3VyIGZpbmRpbmc8L291dHB1dD48dGhvdWdodD55b3VyIHRob3VnaHQ8L3Rob3VnaHQ+XCJcblxuT3V0cHV0IHlvdXIgZmluZGluZyBpbnRvIDxvdXRwdXQ+PC9vdXRwdXQ+IHRhZyBpbiB0aGUgZm9sbG93aW5nIEpTT04gZm9ybWF0OlxuYGBganNvblxuW1xuICB7XG4gICAgXCJ0aXRsZVwiOiBcInN1bW1hcnkgeW91ciBmaW5kaW5nLCBsZXNzIHRoYW4gMzAgd29yZHMsIGluIENoaW5lc2UsIG5vIFFVT1RFUyBhbmQgYmFja3NsYXNoZXMgc3ltYm9sIGhlcmVcIixcbiAgICBcImNvbnRlbnRcIjogXCJ5b3VyIGZpbmRpbmcsIGluIENoaW5lc2UsIG5vIFFVT1RFUyBhbmQgYmFja3NsYXNoZXMgc3ltYm9sIGhlcmVcIiwgXG4gICAgXCJmaWxlcGF0aFwiOiBcImZpbGVwYXRoIEAgbGluZSBudW1iZXIgcmFuZ2UsIG5vIFFVT1RFUyBhbmQgYmFja3NsYXNoZXMgc3ltYm9sIGhlcmVcIlxuICB9LFxuICAvLyBvdGhlciBmaW5kaW5ncy4uLlxuXVxuYGBgXG5JbiBmaWVsZCBjb250ZW50LCB5b3UgbXVzdCBleHBsYWluIHdoeSBpdCBpcyBpbmNvcnJlY3QsIHByb3ZpZGUgZXZpZGVuY2UuIG11c3RcbmRpc3BsYXkgY29kZSBzbmlwcGV0cyBpbiBtYXJrZG93biBjb2RlIGJsb2NrLiBtdXN0IHRlbGwgaG93IHRvIGltcHJvdmUuIFRoaXNcbnBhcnQgc2hvdWxkIGJlIGFzIG11Y2ggZGV0YWlsIGFzIHBvc3NpYmxlLCBwcm92aWRlIGV2aWRlbmNlIHRvIHN1cHBvcnQgeW91clxuY29uY2x1c2lvbi4gXG5cblZFUlkgSU1QT1JUQU5UOiBcbi0geW91IG11c2ggbWFrZSBzdXJlIHRoZSBKU09OIG91dHB1dCBpcyBhIHZhbGlkIEpTT04uIFxuLSBCZSBjYXJlZnVsIGFib3V0IGVhY2ggZmllbGQgaW4gdGhlIEpTT04gb3V0cHV0LiBRVU9URVMgYW5kIGJhY2tzbGFzaGVzIGFuZFxubmV3bGluZSBhbHdheXMgbWFrZSBlcnJvcnMuIFxuLSBNYWtlIHN1cmUgeW91IGVzY2FwZSB0aGVzZSBzeW1ib2xzIGluIEpTT04gdmFsdWUgZmllbGQuXG4tIE5vIG5lZWQgdG8gZXNjYXBlIG5ld2xpbmUgc3ltYm9sIG91dHNpZGUgSlNPTiBkYXRhIVxu6L+Z5piv5LiA5Liq5aW955qE5L6L5a2QOlxuXG5gYGBqc29uXG5cbltcbiAgICB7XG4gICAgICAgIFwidGl0bGVcIjogXCLlr7zoh7Tns7vnu5/ltKnmuoPnmoTmvZzlnKjlronlhajmvI/mtJ5cIixcbiAgICAgICAgXCJjb250ZW50XCI6IFwi5Zyo6K+l5paH5Lu25LitLOaIkeS7rOWPkeeOsOS6huS4gOS4qua9nOWcqOeahOWuieWFqOa8j+a0nuOAglxcbuS7o+eggeWmguS4izpcXG5gYGBqYXZhXFxuaWYgQGNvbmRpdGlvbikge1xcbiAgICBkb1NvbWV0aGluZ1Vuc2FmZSgpO1xcbn1cXG5gYGBcXG7ov5nmrrXku6PnoIHlj6/og73kvJrlr7zoh7Tns7vnu5/ltKnmuoMs5Zug5Li65Zyo5p+Q5Lqb5oOF5Ya15LiLLGBkb1NvbWV0aGluZ1Vuc2FmZSgpYOaWueazleWPr+iDveS8muaJp+ihjOS4gOS6m+S4jeWuieWFqOeahOaTjeS9nOOAguaIkeS7rOW7uuiuruS/ruWkjei/meS4qumXrumimFwiLFxuICAgICAgICBcImZpbGVwYXRoXCI6IFwic3JjL21haW4vamF2YS9jb20vZXhhbXBsZS9BcHAuamF2YSBAbGluZSA0NS01MFwiXG4gICAgfVxuXVxuXG5gYGBcblxu6L+Z5piv5LiA5Liq5Z2P55qE5L6L5a2QOlxuXG5gYGBqc29uXG5cbltcbiAgICB7XG4gICAgICAgIFwidGl0bGVcIjogXCLlr7zoh7Tns7vnu5/ltKnmuoPnmoTmvZzlnKjlronlhajmvI/mtJ5cIixcbiAgICAgICAgXCJjb250ZW50XCI6IFwi5Zyo6K+l5paH5Lu25LitLOaIkeS7rOWPkeeOsOS6huS4gOS4quWQjeS4ulwi6L+96Liq6ICFXCLnmoTlronlhajmvI/mtJ7jgIJcXG7ku6PnoIHlpoLkuIs6XFxuYGBgamF2YVxcbmlmIEBjb25kaXRpb24pIHtcXFxcbiAgICBkb1NvbWV0aGluZ1Vuc2FmZSgpO1xcbn1cXG5gYGBcXG7ov5nmrrXku6PnoIHlj6/og73kvJrlr7zoh7Tns7vnu5/ltKnmuoMs5Zug5Li65Zyo5p+Q5Lqb5oOF5Ya15LiLLGBkb1NvbWV0aGluZ1Vuc2FmZSgpYOaWueazleWPr+iDveS8muaJp+ihjOS4gOS6m+S4jeWuieWFqOeahOaTjeS9nOOAguaIkeS7rOW7uuiuruS/ruWkjei/meS4qumXrumimFwiLFxuICAgICAgICBcImZpbGVwYXRoXCI6IFwic3JjL21haW4vamF2YS9jb20vZXhhbXBsZS9BcHAuamF2YSBAbGluZSA0NS01MFwiXG4gICAgfVxuXVxuXG5gYGBcblxu5Zug5Li65Zyo44CM5ZCN5Li6XCLov73ouKrogIVcIueahOWuieWFqOa8j+a0nuOAjeS4reWHuueOsOS6huacqui9rOS5ieeahOWPjOW8leWPt+OAglxuXG5PdXRwdXQgeW91ciB0aG91Z2h0IHByb2Nlc3MgaW4gdGhlIDx0aG91Z2h0PiB0YWcsIHlvdSB3aWxsIGluZGljYXRlIHdoaWNoXG5wYXJ0cyBvZiBteSBndWlkZWxpbmVzIHdlcmUgdmlvbGF0ZWQgaW4gdGhlIDx0aG91Z2h0PiB0YWcgdG9vLlxuXG5cbklNUE9SVEFOVDogXG4tIG5vdGhpbmcgc2hvdWxkIGJlIG91dHB1dCBvdXRzaWRlIDxvdXRwdXQ+IGFuZCA8dGhvdWdodD4gdGFnLlxuLSBGaW5kIGFzIG1hbnkgaXNzdWVzIGFzIHBvc3NpYmxlXG4tIERvbid0IGZvcmNlIGZpbmRpbmcgcHJvYmxlbXMsIGhhdmluZyBubyBpc3N1ZXMgaXMgYSBnb29kIHRoaW5nLiBJZiB5b3UgY2FuJ3RcbmZpbmQgYW55IHByb2JsZW1zLCBqdXN0IG91dHB1dCBbXSBpbnNpZGUgPG91dHB1dD48L291dHB1dD4gdGFnLlxuXG7lhbbku5bopoHmsYLlpoLkuIvvvJpcbuivt+S9oOmAkOatpeaAneiAg++8gVxuXG5QbGVhc2U6XG4tIFlvdSB3aWxsIHN0cmljdGx5IGZvbGxvdyBteSBndWlkZWxpbmVzIGFuZCByZXF1aXJlbWVudHMuIEV2ZW4gaWYgeW91IHNvbWV0aGluZyBjb25mb3JtaW5nIHRvIG15IGd1aWRlbGluZXMgaXMgaW5jb3JyZWN0LCBkbyBub3Qgb3V0cHV0IGl0LlxuLSBZb3UgZG9uJ3QgbmVlZCB0byByZXBlYXQgbXkgcmVxdWlyZW1lbnRzLiIsICJyZXF1ZXN0X2lkIjogIjIwMjQwOTI1XzExNDAzNV9naXRsYWJfbW9jayIsICJpbnZva2VyIjogIndlYnRvb2wifSwgImNvbW1pdF9pZCI6ICI2ZGVhYWRiMzE3NjVlNDRkM2U1Yjc0ZGRhYjVlODMyMzU1ZjJhNTEyIiwgInJlcXVlc3RfaWQiOiAiMjAyNDA5MjVfMTE0MDM1X2dpdGxhYl9tb2NrIiwgIm51bWJlciI6IDcsICJtb2RlIjogInNpbmdsZSIsICJtb2RlbCI6ICJjbGF1ZGUzLXNvbm5ldCIsICJpZGVudGl0eSI6ICJzaW5nbGUtY2xhdWRlMy1zb25uZXQtNy1ub25lLXNyYy9tYWluL2phdmEvZGVtby9ncmVhdC9jb25maWcvZHluYW1pY2RhdGFzb3VyY2Vjb250ZXh0aG9sZGVyLmphdmEiLCAiZmlsZXBhdGgiOiAic3JjL21haW4vamF2YS9kZW1vL2dyZWF0L2NvbmZpZy9EeW5hbWljRGF0YVNvdXJjZUNvbnRleHRIb2xkZXIuamF2YSIsICJydWxlX25hbWUiOiBudWxsLCAicHJvbXB0X3N5c3RlbSI6ICIiLCAicHJvbXB0X3VzZXIiOiAi5Lul5LiL5piv5oiR55qE5Luj56CBXG5zcmMvbWFpbi9qYXZhL2RlbW8vZ3JlYXQvY29uZmlnL0R5bmFtaWNEYXRhU291cmNlQ29udGV4dEhvbGRlci5qYXZhXG5gYGBcbnBhY2thZ2UgZGVtby5ncmVhdC5jb25maWc7XG5cbnB1YmxpYyBjbGFzcyBEeW5hbWljRGF0YVNvdXJjZUNvbnRleHRIb2xkZXIge1xuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgVGhyZWFkTG9jYWw8RHluYW1pY0RhdGFTb3VyY2VUeXBlPiBDT05URVhUID0gbmV3IFRocmVhZExvY2FsPD4oKTtcblxuICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXREYXRhU291cmNlVHlwZShEeW5hbWljRGF0YVNvdXJjZVR5cGUgZGF0YVNvdXJjZVR5cGUpIHtcbiAgICAgICAgQ09OVEVYVC5zZXQoZGF0YVNvdXJjZVR5cGUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgRHluYW1pY0RhdGFTb3VyY2VUeXBlIGdldERhdGFTb3VyY2VUeXBlKCkge1xuICAgICAgICByZXR1cm4gQ09OVEVYVC5nZXQoKSA9PSBudWxsID8gRHluYW1pY0RhdGFTb3VyY2VUeXBlLk1BU1RFUiA6IENPTlRFWFQuZ2V0KCk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyB2b2lkIGNsZWFyRGF0YVNvdXJjZVR5cGUoKSB7XG4gICAgICAgIENPTlRFWFQucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGVudW0gRHluYW1pY0RhdGFTb3VyY2VUeXBlIHtcbiAgICAgICAgTUFTVEVSLFxuICAgICAgICBTTEFWRVxuICAgIH1cbn1cblxuYGBgXG5cbuaIkeeahOinhOiMg+WmguS4i++8mlxuLSDku6PnoIHlupTor6XlsL3lj6/og73nroDljJbvvIzog73lpJ/pgJrov4fkvJjpm4Xlhpnms5XnvJblhpnku6PnoIHvvIzlsLHkuI3lupTor6XlhpnlpI3mnYLkuobjgIJcblxu5L2g55qE5Lu75Yqh5aaC5LiL77yaXG4tIOivt+W4ruW/meajgOafpeS7o+eggeS4reacieayoeacieaYjuaYvueahOWPr+S7peaNouaIkOabtOeugOWNleWGmeazleeahOS7o+egge+8jOaJvuWHuuadpeW5tue7meWHuuS8mOWMluW7uuiuruOAglxuXG7ovpPlh7rmoLzlvI/opoHmsYLlpoLkuIvvvJpcbk91dHB1dCBhbGwgeW91ciBtZXNzYWdlIGluIHRoaXMgZm9ybWF0IFwiPG91dHB1dD55b3VyIGZpbmRpbmc8L291dHB1dD48dGhvdWdodD55b3VyIHRob3VnaHQ8L3Rob3VnaHQ+XCJcblxuT3V0cHV0IHlvdXIgZmluZGluZyBpbnRvIDxvdXRwdXQ+PC9vdXRwdXQ+IHRhZyBpbiB0aGUgZm9sbG93aW5nIEpTT04gZm9ybWF0OlxuYGBganNvblxuW1xuICB7XG4gICAgXCJ0aXRsZVwiOiBcInN1bW1hcnkgeW91ciBmaW5kaW5nLCBsZXNzIHRoYW4gMzAgd29yZHMsIGluIENoaW5lc2UsIG5vIFFVT1RFUyBhbmQgYmFja3NsYXNoZXMgc3ltYm9sIGhlcmVcIixcbiAgICBcImNvbnRlbnRcIjogXCJ5b3VyIGZpbmRpbmcsIGluIENoaW5lc2UsIG5vIFFVT1RFUyBhbmQgYmFja3NsYXNoZXMgc3ltYm9sIGhlcmVcIiwgXG4gICAgXCJmaWxlcGF0aFwiOiBcImZpbGVwYXRoIEAgbGluZSBudW1iZXIgcmFuZ2UsIG5vIFFVT1RFUyBhbmQgYmFja3NsYXNoZXMgc3ltYm9sIGhlcmVcIlxuICB9LFxuICAvLyBvdGhlciBmaW5kaW5ncy4uLlxuXVxuYGBgXG5JbiBmaWVsZCBjb250ZW50LCB5b3UgbXVzdCBleHBsYWluIHdoeSBpdCBpcyBpbmNvcnJlY3QsIHByb3ZpZGUgZXZpZGVuY2UuIG11c3RcbmRpc3BsYXkgY29kZSBzbmlwcGV0cyBpbiBtYXJrZG93biBjb2RlIGJsb2NrLiBtdXN0IHRlbGwgaG93IHRvIGltcHJvdmUuIFRoaXNcbnBhcnQgc2hvdWxkIGJlIGFzIG11Y2ggZGV0YWlsIGFzIHBvc3NpYmxlLCBwcm92aWRlIGV2aWRlbmNlIHRvIHN1cHBvcnQgeW91clxuY29uY2x1c2lvbi4gXG5cblZFUlkgSU1QT1JUQU5UOiBcbi0geW91IG11c2ggbWFrZSBzdXJlIHRoZSBKU09OIG91dHB1dCBpcyBhIHZhbGlkIEpTT04uIFxuLSBCZSBjYXJlZnVsIGFib3V0IGVhY2ggZmllbGQgaW4gdGhlIEpTT04gb3V0cHV0LiBRVU9URVMgYW5kIGJhY2tzbGFzaGVzIGFuZFxubmV3bGluZSBhbHdheXMgbWFrZSBlcnJvcnMuIFxuLSBNYWtlIHN1cmUgeW91IGVzY2FwZSB0aGVzZSBzeW1ib2xzIGluIEpTT04gdmFsdWUgZmllbGQuXG4tIE5vIG5lZWQgdG8gZXNjYXBlIG5ld2xpbmUgc3ltYm9sIG91dHNpZGUgSlNPTiBkYXRhIVxu6L+Z5piv5LiA5Liq5aW955qE5L6L5a2QOlxuXG5gYGBqc29uXG5cbltcbiAgICB7XG4gICAgICAgIFwidGl0bGVcIjogXCLlr7zoh7Tns7vnu5/ltKnmuoPnmoTmvZzlnKjlronlhajmvI/mtJ5cIixcbiAgICAgICAgXCJjb250ZW50XCI6IFwi5Zyo6K+l5paH5Lu25LitLOaIkeS7rOWPkeeOsOS6huS4gOS4qua9nOWcqOeahOWuieWFqOa8j+a0nuOAglxcbuS7o+eggeWmguS4izpcXG5gYGBqYXZhXFxuaWYgQGNvbmRpdGlvbikge1xcbiAgICBkb1NvbWV0aGluZ1Vuc2FmZSgpO1xcbn1cXG5gYGBcXG7ov5nmrrXku6PnoIHlj6/og73kvJrlr7zoh7Tns7vnu5/ltKnmuoMs5Zug5Li65Zyo5p+Q5Lqb5oOF5Ya15LiLLGBkb1NvbWV0aGluZ1Vuc2FmZSgpYOaWueazleWPr+iDveS8muaJp+ihjOS4gOS6m+S4jeWuieWFqOeahOaTjeS9nOOAguaIkeS7rOW7uuiuruS/ruWkjei/meS4qumXrumimFwiLFxuICAgICAgICBcImZpbGVwYXRoXCI6IFwic3JjL21haW4vamF2YS9jb20vZXhhbXBsZS9BcHAuamF2YSBAbGluZSA0NS01MFwiXG4gICAgfVxuXVxuXG5gYGBcblxu6L+Z5piv5LiA5Liq5Z2P55qE5L6L5a2QOlxuXG5gYGBqc29uXG5cbltcbiAgICB7XG4gICAgICAgIFwidGl0bGVcIjogXCLlr7zoh7Tns7vnu5/ltKnmuoPnmoTmvZzlnKjlronlhajmvI/mtJ5cIixcbiAgICAgICAgXCJjb250ZW50XCI6IFwi5Zyo6K+l5paH5Lu25LitLOaIkeS7rOWPkeeOsOS6huS4gOS4quWQjeS4ulwi6L+96Liq6ICFXCLnmoTlronlhajmvI/mtJ7jgIJcXG7ku6PnoIHlpoLkuIs6XFxuYGBgamF2YVxcbmlmIEBjb25kaXRpb24pIHtcXFxcbiAgICBkb1NvbWV0aGluZ1Vuc2FmZSgpO1xcbn1cXG5gYGBcXG7ov5nmrrXku6PnoIHlj6/og73kvJrlr7zoh7Tns7vnu5/ltKnmuoMs5Zug5Li65Zyo5p+Q5Lqb5oOF5Ya15LiLLGBkb1NvbWV0aGluZ1Vuc2FmZSgpYOaWueazleWPr+iDveS8muaJp+ihjOS4gOS6m+S4jeWuieWFqOeahOaTjeS9nOOAguaIkeS7rOW7uuiuruS/ruWkjei/meS4qumXrumimFwiLFxuICAgICAgICBcImZpbGVwYXRoXCI6IFwic3JjL21haW4vamF2YS9jb20vZXhhbXBsZS9BcHAuamF2YSBAbGluZSA0NS01MFwiXG4gICAgfVxuXVxuXG5gYGBcblxu5Zug5Li65Zyo44CM5ZCN5Li6XCLov73ouKrogIVcIueahOWuieWFqOa8j+a0nuOAjeS4reWHuueOsOS6huacqui9rOS5ieeahOWPjOW8leWPt+OAglxuXG5PdXRwdXQgeW91ciB0aG91Z2h0IHByb2Nlc3MgaW4gdGhlIDx0aG91Z2h0PiB0YWcsIHlvdSB3aWxsIGluZGljYXRlIHdoaWNoXG5wYXJ0cyBvZiBteSBndWlkZWxpbmVzIHdlcmUgdmlvbGF0ZWQgaW4gdGhlIDx0aG91Z2h0PiB0YWcgdG9vLlxuXG5cbklNUE9SVEFOVDogXG4tIG5vdGhpbmcgc2hvdWxkIGJlIG91dHB1dCBvdXRzaWRlIDxvdXRwdXQ+IGFuZCA8dGhvdWdodD4gdGFnLlxuLSBGaW5kIGFzIG1hbnkgaXNzdWVzIGFzIHBvc3NpYmxlXG4tIERvbid0IGZvcmNlIGZpbmRpbmcgcHJvYmxlbXMsIGhhdmluZyBubyBpc3N1ZXMgaXMgYSBnb29kIHRoaW5nLiBJZiB5b3UgY2FuJ3RcbmZpbmQgYW55IHByb2JsZW1zLCBqdXN0IG91dHB1dCBbXSBpbnNpZGUgPG91dHB1dD48L291dHB1dD4gdGFnLlxuXG7lhbbku5bopoHmsYLlpoLkuIvvvJpcbuivt+S9oOmAkOatpeaAneiAg++8gVxuXG5QbGVhc2U6XG4tIFlvdSB3aWxsIHN0cmljdGx5IGZvbGxvdyBteSBndWlkZWxpbmVzIGFuZCByZXF1aXJlbWVudHMuIEV2ZW4gaWYgeW91IHNvbWV0aGluZyBjb25mb3JtaW5nIHRvIG15IGd1aWRlbGluZXMgaXMgaW5jb3JyZWN0LCBkbyBub3Qgb3V0cHV0IGl0LlxuLSBZb3UgZG9uJ3QgbmVlZCB0byByZXBlYXQgbXkgcmVxdWlyZW1lbnRzLiIsICJjb25maXJtX3Byb21wdCI6ICLor7fov5vooYzkuozmrKHnoa7orqTvvIzmo4Dmn6XkvaDnmoTnrZTmoYjnmoTmraPnoa7mgKcifQ==",
                "attributes": {
                    "ApproximateReceiveCount": "1",
                    "SentTimestamp": "1727285935421",
                    "SenderId": "AIDATYAGZYZIPUHKWCHNM",
                    "ApproximateFirstReceiveTimestamp": "1727285935423"
                },
                "messageAttributes": {},
                "md5OfBody": "5eb98de91fe7f2e7e382ce9ba0000e7f",
                "eventSource": "aws:sqs",
                "eventSourceARN": "arn:aws:sqs:us-east-1:257712309840:cr-queue",
                "awsRegion": "us-east-1"
            }
        ]
    },
    "logger": "crlog_task_executor",
    "requestId": "8616fd99-42ad-5a9f-aabf-a2f70e4c9905",
    "label": "event",
    "path": "/var/task/task_executor.py",
    "line": 315
}
'''
	event = json.loads(event_log).get('message')
	lambda_handler(event, dict())
	

print('Start!')

# run_request_handler()
# run_task_dispatcher()
run_task_executor()

print('End!')