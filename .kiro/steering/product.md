# 产品概述

Code Reviewer是一个基于AWS构建的无服务器AI代码评审解决方案，集成Git仓库 (GitLab, GitHub, CodeCommit)，使用Amazon Bedrock提供自动化代码分析。

## 核心功能
- 通过仓库webhook触发的自动化代码评审 (push, merge事件)
- 使用Amazon Bedrock的Claude 3模型进行AI分析
- 存储在`.codereview/*.yaml`文件中的可定制评审规则
- 生成包含详细反馈的HTML报告
- 支持多仓库，可配置评审模式 (diff, 单文件, 全仓库)
- 基于Web的测试和配置工具
- 目前支持GitLab集成，采用可扩展设计为未来GitHub和CodeCommit支持预留接口

## 评审规则系统
- **多规则处理**: 所有匹配分支条件的`.codereview/*.yaml`文件都会被处理
- **无优先级**: 规则独立执行，没有优先级排序
- **分支匹配**: 每个规则包含`branch`字段来确定适用性
- **并行处理**: 多个规则可以同时为同一个代码评审请求运行
- **结果聚合**: 所有规则结果合并到一个综合报告中
- **冲突解决**: 当多个规则对同一代码提供不同建议时，所有建议都包含在报告中供用户决策

## 评审模式与触发器
- **WebTool触发**: 通过Web界面手动评审，用户指定模式
- **仓库Hook**: 基于git事件自动触发 (push, merge)，模式由规则配置决定
- **diff**: 仅评审提交间的变更文件
- **single**: 评审单个文件
- **all**: 评审整个仓库代码库

## 模块化评审支持
- **基于目标的模块**: 在规则中使用`target`字段指定文件模式
- **路径模式**: 支持glob模式如`"base/**, user/**"`进行模块特定评审
- **大型项目处理**: 将大型代码库分解为可管理的评审块

## 关键特性
- 使用AWS Lambda, SQS, DynamoDB, S3的无服务器架构
- 带进度跟踪的异步任务处理
- 通过SMTP集成的邮件通知
- 用于webhook集成的API Gateway端点
- 超时处理和故障恢复机制
- 通过模块化评审方法支持大型代码库
- 可扩展的仓库集成设计 (目前支持GitLab，未来支持GitHub/CodeCommit)
- 简单的成本模型，暂无内置成本控制

## 数据库设计
- **Request表**: 分区键`commit_id`，排序键`request_id`，包含TaskStatusIndex全局二级索引
- **Task表**: 分区键`request_id`，排序键`number`(数字类型)
- **计费模式**: 按需付费(PAY_PER_REQUEST)
- **加密**: AWS托管加密
- **备份**: 启用时间点恢复

## 配置系统
- **系统提示**: 每个规则文件支持自定义`system`字段用于Claude提示
- **仓库配置**: 通过`repos.json`和`data_initializer.py`进行初始设置
- **规则模板**: 在`rules.json`中定义常见场景的默认规则
- **基于分支的触发器**: 仓库hook根据分支模式确定评审模式

## 超时与错误处理
- **15分钟超时**: 未完成的评审生成包含已完成任务结果的部分报告
- **异步处理**: 任务独立执行，失败不会阻塞其他任务
- **进度跟踪**: 通过DynamoDB和结果检查器API进行实时状态更新

## 目标用户
寻求自动化代码质量保证和跨仓库一致评审标准的开发团队。